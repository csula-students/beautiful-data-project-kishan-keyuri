package cs594Homework2;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Collection;
import java.util.Date;

import org.json.simple.JSONObject;
import org.json.simple.parser.ParseException;

public class CollectorApp {
	public static void main(String[] args) throws IOException
	{
		
		SourceImpl impl = new SourceImpl();
		CollectorImpl cimpl=new CollectorImpl();
		Date d=new Date();
		SimpleDateFormat format=new SimpleDateFormat("yyyy-MM-dd");
		String last=format.format(d);
		String[] arr={
				"1900-06-01","1900-12-31","1901-06-01","1901-12-31","1902-06-01","1902-12-31","1903-06-01",
				"1903-12-31","1904-06-01","1904-12-31","1905-06-01","1905-12-31","1906-06-01","1906-12-31",
				"1907-06-01","1907-12-31","1908-06-01","1908-12-31","1909-06-01","1909-12-31","1910-06-01",
				"1910-12-31","1911-06-01","1911-12-31","1912-06-01","1912-12-31",
				"1913-06-01","1913-12-31","1914-06-01","1914-12-31","1915-06-01","1915-12-31","1916-06-01",
				"1916-12-31","1917-06-01","1917-12-31","1918-06-01","1918-12-31","1919-06-01","1919-12-31",
				"1920-06-01","1920-12-31","1921-06-01","1921-12-31","1922-06-01","1922-12-31","1923-06-01",
				"1923-12-31","1924-06-01","1924-12-31","1925-06-01","1925-12-31","1926-06-01","1926-12-31",
				"1927-06-01","1927-12-31","1928-06-01","1928-12-31","1929-06-01","1929-12-31","1930-06-01",
				"1930-12-31","1931-06-01","1931-12-31","1932-06-01","1932-12-31","1933-06-01","1933-12-31",
				"1934-06-01","1934-12-31","1935-06-01","1935-12-31","1936-06-01","1936-12-31","1937-06-01",
				"1937-12-31","1938-06-01","1938-12-31","1939-06-01","1939-12-31","1940-06-01","1940-12-31",
				"1941-06-01","1941-12-31","1942-06-01","1942-12-31","1943-06-01","1943-12-31","1944-06-01",
				"1944-12-31","1945-06-01","1945-12-31","1946-06-01","1946-12-31","1947-06-01","1947-12-31",
				"1948-06-01","1948-12-31","1949-06-01","1949-12-31","1950-06-01","1950-12-31","1951-06-01",
				"1951-12-31","1952-06-01","1952-12-31","1953-06-01","1953-12-31","1954-06-01","1954-12-31",
				"1955-06-01","1955-12-31","1956-06-01","1956-12-31","1957-06-01","1957-12-31","1958-06-01",
				"1958-12-31","1959-06-01","1959-12-31","1960-06-01","1960-12-31","1961-06-01","1961-12-31",
				"1962-06-01","1962-12-31","1963-06-01",
				"1963-12-31","1964-06-01","1964-12-31","1965-06-01","1965-12-31","1966-06-01","1966-12-31",
				"1967-06-01","1967-12-31","1968-06-01","1968-12-31","1969-06-01","1969-12-31","1970-06-01",
				"1970-12-31","1971-06-01","1971-12-31","1972-06-01","1972-12-31","1973-06-01","1973-12-31",
				"1974-06-01",
				"1974-12-31","1975-06-01","1975-12-31","1976-06-01","1976-12-31","1977-06-01","1977-12-31",
				"1978-06-01","1978-12-31","1979-06-01","1979-12-31","1980-12-31","1981-06-01","1981-12-31",
				"1982-06-01","1982-12-31","1983-06-01","1983-12-31","1984-06-01","1984-12-31","1985-06-01",
				"1985-12-31","1986-06-01","1986-12-31","1987-06-01","1987-12-31","1988-06-01","1988-12-31",
				"1989-06-01","1989-12-31","1990-06-01","1990-06-31","1991-06-01","1991-12-31","1992-06-01",
				"1992-12-31","1993-06-01","1993-12-31","1994-06-01",
				"1994-12-31","1995-06-01","1995-12-31","1996-06-01","1996-12-31","1997-06-01","1997-12-31",
				"1998-06-01","1998-12-31","1999-06-01","1999-12-31","2001-06-01","2001-12-31","2002-06-01",
				"2002-12-31",
				"2003-06-01","2003-12-31","2004-06-01","2004-12-31","2005-06-01","2005-12-31","2006-06-01",
					"2006-12-31","2007-06-01","2007-12-31","2008-06-01","2008-12-31","2009-06-01","2009-12-31",
				"2010-06-01","2010-12-31","2011-06-01","2011-12-31","2012-06-01","2012-12-31","2013-06-01",
				"2013-12-31","2014-06-01","2014-12-31","2015-06-01","2015-12-31","2016-04-01","2016-06-08",last};
	
		JSONObject obj;
		int i=0;
		Collection<ModelClass> clean_collection=null;
		File file=new File(System.getProperty("user.dir")+"/src/main/resources/data.json");
		if (!file.exists()) {
			file.createNewFile();
		}
		while(impl.hasNext(arr,i))
		{
			System.out.println("COndition: "+impl.hasNext(arr,i));
			try {	
				obj=impl.getData(arr[i], arr[i+1]);
				//System.out.println(System.getProperty("user.dir"));				
				
				
				FileWriter fw = new FileWriter(file.getAbsoluteFile(),true);
				//System.out.println("Obj STring: "+obj.toString());
				fw.write(obj.toString());
				fw.flush();
				fw.close();
				//pass to mungee
				clean_collection=cimpl.mungee(obj);
				cimpl.save(clean_collection);
				i+=1;
				System.out.println("finished");
			} catch (ParseException e){ 
					// TODO Auto-generated catch block					
					//e.printStackTrace();
			} catch (IOException e) {
				// TODO Auto-generated catch block
				//e.printStackTrace();
			}				
		}
	}
}
